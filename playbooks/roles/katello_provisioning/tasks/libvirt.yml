---
- name: 'install the virtualization hypervisor package group'
  yum:
    name: "@Virtualization Hypervisor"
    state: present

- name: 'install the virtualization tools package group'
  yum:
    name: "@Virtualization Tools"
    state: present

- name: 'disable libvirt authentication'
  lineinfile:
    dest: /etc/libvirt/libvirtd.conf
    line: 'auth_unix_rw = "none"'

- name: 'restart libvirt'
  service: name=libvirtd state=restarted

- name: 'create the provisioning libvirt network'
  virt_net:
    command: define
    name: provision
    xml: '{{ lookup("template", "../templates/network.xml.j2") }}'

- name: 'create the provisioning storage network'
  virt_pool:
    command: define
    name: provision
    xml: '{{ lookup("template", "../templates/storage.xml.j2") }}'

- name: 'create /var/lib/tftpboot so libvirt starts'
  file: path=/var/lib/tftpboot state=directory mode=0755

- name: 'start the provision libvirt network'
  virt_net: state=active name=provision

- name: 'start the provision libvirt storage pool'
  virt_pool: state=active name=provision

- name: 'install libvirt gem'
  yum: name=rubygem-ruby-libvirt state=present

- name: 'install foreman-libvirt'
  yum: name=foreman-libvirt state=present
